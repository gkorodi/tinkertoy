# tinkertoy

This is just a [FastAPI](https://fastapi.tiangolo.com/) based mini application.

# The Application

The application is a single python script, running a FastAPI server. Check the Swagger documentation of the application once it is deployed. There is no UI, except what is generated by the FastAPI Swagger component by default. [Tinkertoy Swagger Localhost](http://localhost:8000/docs)

The minimum dependencies for the application is a single library called FastAPI. In addition, the `unicorn` library is included, to be able to run the app locally, with more bells and whistles for webtraffic. See this [good explanation](https://developer.vonage.com/en/blog/how-wsgi-vs-asgi-is-like-baking-a-cake) why.

Basic foreground run of the application is with:

```sh
fastapi dev fastapi/app.py

```

## Testing

If `pytest` is installed, just run `pytest` from the root/app directory, and see what happens.

# Deploy to Azure App Service - Sample Application

To deploy our toy API with Azure Quickstart see [Deploy a Python (Django or Flask) web app to Azure App Service](https://docs.microsoft.com/en-us/azure/app-service/quickstart-python). For instructions on how to create the Azure resources and deploy the application to Azure, refer to the article.

Sample applications are available for the other frameworks here:

* Django [https://github.com/Azure-Samples/msdocs-python-django-webapp-quickstart](https://github.com/Azure-Samples/msdocs-python-django-webapp-quickstart)
* FastAPI [https://github.com/Azure-Samples/msdocs-python-fastapi-webapp-quickstart](https://github.com/Azure-Samples/msdocs-python-fastapi-webapp-quickstart)

If you need an Azure account, you can [create one for free](https://azure.microsoft.com/en-us/free/).

## Commands to script with for Azure deployment

Of course, installing the `az` command on your particular system is a prerequisite. Also, logging in with `az login` and having an actual account with enough privileges to deploy the webapp is also required. _Note: More on Azure infrastructure setup, later._

### Deploy

```sh

APP_SERVICE_NAME="tinkertoy"
az webapp up --runtime PYTHON:3.12 --sku B1 --logs --name $APP_SERVICE_NAME`

```

The `--runtime` parameter specifies what version of Python your app is running. To list all available runtimes, 
use the command `az webapp list-runtimes --os linux --output table`.

The `--sku` parameter defines the size (CPU, memory) **and cost** of the app service plan.  This example uses the **B1 (Basic)** service plan, which will incur a small cost in your Azure subscription. Don't forget to shut down the app if not used! See instructions below.

For a full list of App Service plans, view the App Service pricing page.

The `--logs` flag configures default logging required to enable viewing the log stream immediately after launching the webapp.

You can optionally specify a name with the argument `--name <app-name>`. If you don't provide one, then a name will be automatically generated.

You can optionally include the argument `--location <location-name>` where `<location_name>` is an available *Azure region*. You can retrieve a list of allowable regions for your Azure account by running the [az account list-locations](https://learn.microsoft.com/en-us/cli/azure/appservice#az-appservice-list-locations) command.

### Configure logging

`az webapp log config --web-server-logging filesystem --name $APP_SERVICE_NAME --resource-group $RESOURCE_GROUP_NAME`

### Tail the log for a running application

`az webapp log tail --name $APP_SERVICE_NAME --resource-group $RESOURCE_GROUP_NAME`


### Delete an Azure Resource Group

`az group delete --name RESOURCE_GROUP_NAME # --no-wait`
